#Connect-ExchangeOnline

 

$ad1 = Get-ADGroup -filter * -Properties * | Where-Object {$_.GroupCategory -eq "Distribution"} | select name,description,GroupCategory,mail,SamAccountName,CanonicalName

 

#$ad1 = Get-ADGroup -Identity DLT-PT-LIS2-TECHNIQUE-LISBOA -Properties * | Where-Object {$_.GroupCategory -eq "Distribution"} | select name,description,GroupCategory,mail,SamAccountName,CanonicalName

 

$Results = foreach( $group in $ad1 ){
    $count1=(Get-ADGroupMember -Recursive $ad1.SamAccountName ).Count
    $trace = Get-MessageTrace -RecipientAddress $ad.mail -StartDate (get-date).AddDays(-10) -EndDate (get-date).AddDays(+1)
    $lastmail = $trace | select-object -first 1 |select received

 

    New-Object -TypeName psobject -Property @{
        Name                     = $ad1.name
        description              = $ad1.description
        GroupCategory            = $ad1.GroupCategory
        MemberCount              = $count1
        Mail                     = $ad1.mail
        SamAccountName           = $ad1.SamAccountName
        Lastmail                 = $lastmail.Received  
        CanonicalName            = $ad1.CanonicalName     

 


        }
    }

 

$Results | select name,description,GroupCategory,MemberCount,Mail,SamAccountName,Lastmail,CanonicalName

 

$Results | export-csv c:/temp/yasar.csv